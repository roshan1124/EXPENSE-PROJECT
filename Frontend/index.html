<!DOCTYPE html>
<html>
<head>
  <title>Expense Tracker</title>
  <style>
    body { font-family: Arial; background: #f5f7fb; padding: 30px; }
    .box { max-width: 700px; background: #fff; padding: 20px; border-radius: 8px; }
    input, button { width: 100%; padding: 10px; margin: 6px 0; }
    button { background: #4f46e5; color: white; border: none; cursor: pointer; }
    ul { background: #f1f1f1; padding: 10px; }
    pre { background: #f1f1f1; padding: 10px; margin-top: 10px; }
    h4 { margin-top: 20px; }
  </style>
</head>
<body>

<div class="box">
  <h2>Expense Tracker</h2>

  <h4>Create User</h4>
  <input id="userName" placeholder="User name">
  <button onclick="createUser()">Create User</button>

  <ul id="userList"><b>Users (ID : Name)</b></ul>

  <h4>Create Group</h4>
  <input id="groupName" placeholder="Group name">
  <input id="groupUsers" placeholder="User IDs (comma separated)">
  <button onclick="createGroup()">Create Group</button>

  <ul id="groupList"><b>Groups (ID : Name)</b></ul>

  <h4>Add Expense</h4>
  <input id="desc" placeholder="Description">
  <input id="amount" type="number" placeholder="Amount">
  <input id="paidBy" type="number" placeholder="Paid By (user id)">
  <input id="groupId" type="number" placeholder="Group ID">
  <button onclick="addExpense()">Add Expense</button>

  <h4>Get Balances</h4>
  <input id="balanceGroupId" type="number" placeholder="Group ID">
  <button onclick="getBalances()">Get Balances</button>

  <pre id="output">Output...</pre>
</div>

<script>
const API = "http://localhost:3000";
const out = document.getElementById("output");
const userList = document.getElementById("userList");
const groupList = document.getElementById("groupList");

function show(data) {
  out.textContent = JSON.stringify(data, null, 2);
}

function createUser() {
  fetch(API + "/users", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ name: userName.value })
  })
  .then(r => r.json())
  .then(data => {
    const li = document.createElement("li");
    li.textContent = `${data.user.id} : ${data.user.name}`;
    userList.appendChild(li);
    show(data);
    userName.value = "";
  });
}

function createGroup() {
  const ids = groupUsers.value.split(",").map(Number);
  fetch(API + "/groups", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ name: groupName.value, userIds: ids })
  })
  .then(r => r.json())
  .then(data => {
    const li = document.createElement("li");
    li.textContent = `${data.group.id} : ${data.group.name}`;
    groupList.appendChild(li);
    show(data);
    groupName.value = "";
    groupUsers.value = "";
  });
}

function addExpense() {
  fetch(API + "/expenses", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      description: desc.value,
      amount: Number(amount.value),
      paidBy: Number(paidBy.value),
      groupId: Number(groupId.value),
      splitType: "EQUAL",
      splitDetails: {}
    })
  }).then(r => r.json()).then(show);
}

function getBalances() {
  fetch(API + "/balances?groupId=" + balanceGroupId.value)
    .then(r => r.json())
    .then(show);
}
</script>

</body>
</html>
